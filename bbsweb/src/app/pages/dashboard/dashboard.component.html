<p-card *ngIf="hasPrivilege(Permissions.VIEW_MAIN_DASHBOARD)" styleClass="mb-6 rounded-lg   ">
    <ng-template pTemplate="title">
        <div class="flex items-center p-3   text-white rounded-t-lg">
            <i class="pi pi-th-large mr-2 text-2xl"></i>
            <h1 class="text-2xl font-semibold">Admin Dashboard</h1>
        </div>
    </ng-template>

    <div class="p-4">
        <p class=" dark:text-gray-300 mb-6 ml-1">Key business metrics and recent activities.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <div class="flex items-center p-3">
                    <div class="p-2 bg-blue-100  rounded-full mr-3">
                        <i class="pi pi-users text-blue-600 dark:text-blue-400 text-2xl"></i>
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-base font-medium  dark:text-slate-200">Total Clients</h3>
                        <p class="text-3xl font-bold text-blue-600 dark:text-blue-400">{{ totalClients }}</p>
                    </div>
                </div>
                <p-divider layout="horizontal" styleClass="my-1 border-gray-200 dark:border-slate-700"></p-divider>
                <div class="px-3 pb-2">
                    <div class="flex justify-between items-center mb-1">
                        <div class="flex items-center">
                            <i class="pi pi-check-circle text-green-500 dark:text-green-400 mr-1"></i>
                            <span class="text-sm font-medium  dark:text-slate-300">Active</span>
                        </div>
                        <p class="text-lg font-bold text-green-600 dark:text-green-400">{{ totalClients }}</p>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <i class="pi pi-minus-circle text-amber-500 dark:text-amber-400 mr-1"></i>
                            <span class="text-sm font-medium  dark:text-slate-300">Inactive</span>
                        </div>
                        <p class="text-lg font-bold text-amber-600 dark:text-amber-400">{{ 0 }}</p>
                    </div>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <div class="flex items-center p-3">
                    <div class="p-2 bg-green-100 dark:bg-green-500/20 rounded-full mr-3">
                        <i class="pi pi-chart-line text-green-600 dark:text-green-400 text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-base font-medium  dark:text-slate-200">Total Revenue (Cleared)</h3>
                        <p class="text-xl font-bold text-green-600 dark:text-green-400">
                            KSH {{ stats?.invoiceStats?.totalRevenue | number: '1.2-2' }}
                        </p>
                    </div>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <div class="flex items-center p-3">
                    <div class="p-2 bg-indigo-100 dark:bg-indigo-500/20 rounded-full mr-3">
                        <i class="pi pi-shield text-indigo-600 dark:text-indigo-400 text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-base font-medium  dark:text-slate-200">Total Agents</h3>
                        <p class="text-xl font-bold text-indigo-600 dark:text-indigo-400">{{ stats?.totalAgents }}</p>
                    </div>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <div class="flex items-center p-3">
                    <div class="p-2 bg-purple-100 dark:bg-purple-500/20 rounded-full mr-3">
                        <i class="pi pi-briefcase text-purple-600 dark:text-purple-400 text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-base font-medium  dark:text-slate-200">Commitments</h3>
                        <p class="text-xl font-bold text-purple-600 dark:text-purple-400">{{ stats?.commitMentClients }}</p>
                    </div>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <div class="flex items-center p-3">
                    <div class="p-2 bg-teal-100 dark:bg-teal-500/20 rounded-full mr-3">
                        <i class="pi pi-users text-teal-600 dark:text-teal-400 text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-base font-medium  dark:text-slate-200">System Users</h3>
                        <p class="text-xl font-bold text-teal-600 dark:text-teal-400">{{ stats?.totalSystemUsers }}</p>
                    </div>
                </div>
            </p-card>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <ng-template pTemplate="header">
                    <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                        <i class="pi pi-file-invoice-dollar mr-1 text-lg text-indigo-600 dark:text-indigo-400"></i>
                        <h3 class="text-base font-medium text-indigo-700 dark:text-indigo-300">Invoice Statistics</h3>
                    </div>
                </ng-template>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 p-3">
                    <div class="text-center p-2 bg-green-50 dark:bg-green-500/10 rounded-md">
                        <p class=" dark:text-slate-300 text-sm">Total Revenue (Cleared)</p>
                        <p class="text-lg font-bold text-green-600 dark:text-green-400">KSH {{ stats?.invoiceStats?.totalRevenue | number: '1.2-2' }}</p>
                    </div>
                    <div class="text-center p-2 bg-yellow-50 dark:bg-yellow-500/10 rounded-md">
                        <p class=" dark:text-slate-300 text-sm">Pending to be Cleared</p>
                        <p class="text-lg font-bold text-yellow-600 dark:text-yellow-400">KSH {{ stats?.invoiceStats?.pendingToBeClearedAmount | number: '1.2-2' }}</p>
                    </div>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <ng-template pTemplate="header">
                    <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                        <i class="pi pi-star-fill mr-1 text-lg text-blue-600 dark:text-blue-400"></i>
                        <h3 class="text-base font-medium text-blue-700 dark:text-blue-300">Highest Revenue by Client</h3>
                    </div>
                </ng-template>
                <div class="text-center p-3">
                    <p class=" dark:text-slate-300 text-sm">Client: <span class="font-medium text-gray-800 dark:text-slate-100">{{ stats?.highestRevenueClient?.clientName }}</span></p>
                    <p class="text-lg font-bold text-blue-600 dark:text-blue-400">KSH {{ stats?.highestRevenueClient?.totalRevenue | number: '1.2-2' }}</p>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <ng-template pTemplate="header">
                    <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                        <i class="pi pi-crown mr-1 text-lg text-amber-600 dark:text-amber-400"></i>
                        <h3 class="text-base font-medium text-amber-700 dark:text-amber-300">Super Admins</h3>
                    </div>
                </ng-template>
                <div class="p-3">
                    <p *ngIf="!stats?.superAdmins?.length" class=" dark:text-slate-300 text-sm">No super admins found.</p>
                    <div *ngFor="let admin of stats?.superAdmins" class="flex items-center mb-2">
                        <i class="pi pi-user mr-2 text-amber-500 dark:text-amber-400"></i>
                        <p class=" dark:text-slate-300 text-sm" [pTooltip]="'Username: ' + admin.username" tooltipPosition="top">{{ admin.name }}</p>
                    </div>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <ng-template pTemplate="header">
                    <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                        <i class="pi pi-chart-bar mr-1 text-lg text-teal-600 dark:text-teal-400"></i>
                        <h3 class="text-base font-medium text-teal-700 dark:text-teal-300">Client Source Distribution</h3>
                    </div>
                </ng-template>
                <div class="p-3">
                    <p-chart type="bar" [data]="clientSourceChartData" [options]="clientSourceChartOptions"></p-chart>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <ng-template pTemplate="header">
                    <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                        <i class="pi pi-chart-line mr-1 text-lg text-green-600 dark:text-green-400"></i>
                        <h3 class="text-base font-medium text-green-700 dark:text-green-300">Revenue Over Time</h3>
                    </div>
                </ng-template>
                <div class="p-3">
                    <p-chart type="line" [data]="revenueOverTimeChartData" [options]="timeSeriesChartOptions"></p-chart>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
                <ng-template pTemplate="header">
                    <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                        <i class="pi pi-chart-line mr-1 text-lg text-pink-600 dark:text-pink-400"></i>
                        <h3 class="text-base font-medium text-pink-700 dark:text-pink-300">Clients Over Time</h3>
                    </div>
                </ng-template>
                <div class="p-3">
                    <p-chart type="line" [data]="clientsOverTimeChartData" [options]="clientsOverTimeChartOptions"></p-chart>
                </div>
            </p-card>

            <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700 lg:col-span-2">
                <ng-template pTemplate="header">
                    <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                        <i class="pi pi-history mr-1 text-lg  dark:text-gray-400"></i>
                        <h3 class="text-base font-medium  dark:text-slate-300">Recent Activities</h3>
                    </div>
                </ng-template>
                <div class="p-3">
                    <p-progressSpinner *ngIf="loading" styleClass="w-10 h-10 mx-auto" strokeWidth="3" animationDuration=".5s"></p-progressSpinner>
                    <p-table *ngIf="!loading" [value]="stats?.recentActivities ?? []" [paginator]="true" [rows]="5"
                             styleClass="p-datatable-striped p-datatable-gridlines" responsiveLayout="scroll" [tableStyle]="{'min-width': '40rem'}">
                        <ng-template pTemplate="header">
                            <tr class="bg-gray-50 dark:bg-slate-700">
                                <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Description</th>
                                <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Client ID</th>
                                <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Timestamp</th>
                                <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">User</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-activity>
                            <tr class="hover:bg-gray-50 dark:hover:bg-slate-700">
                                <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.description }}</td>
                                <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.clientId }}</td>
                                <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.timestamp | date: 'medium' }}</td>
                                <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.user || 'System' }}</td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="4" class="text-center p-3 text-gray-500 dark:text-gray-400">No recent activities found.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-card>
        </div>
    </div>
</p-card>

<div *ngIf="hasPrivilege(Permissions.VIEW_CLIENT_DASHBOARD) && stats && !loading" class="p-4 min-h-screen bg-gray-50 dark:bg-slate-900">
    <div class="mb-6 p-3  text-white rounded-lg">
        <div class="flex items-center">
            <i class="pi pi-user mr-2 text-2xl"></i>
            <div>
                <h1 class="text-2xl font-semibold">Your Project Dashboard</h1>
                <p class="mt-1 text-sm opacity-90">Track your project progress and financials</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <ng-template pTemplate="header">
                <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                    <i class="pi pi-folder-open mr-1 text-lg text-teal-700 dark:text-teal-400"></i>
                    <h3 class="text-base font-medium text-teal-800 dark:text-teal-300">Project Details</h3>
                </div>
            </ng-template>
            <div class="p-3 space-y-2">
                <p class="text-sm flex items-center  dark:text-slate-300"><i class="pi pi-briefcase mr-1 text-teal-500 dark:text-teal-400"></i><span class="font-medium text-gray-800 dark:text-slate-100">Project:</span> <span class="ml-1">{{ stats?.projectDetails?.projectName || 'N/A' }}</span></p>
                <p class="text-sm flex items-center  dark:text-slate-300"><i class="pi pi-tag mr-1 text-teal-500 dark:text-teal-400"></i><span class="font-medium text-gray-800 dark:text-slate-100">Stage:</span> <span class="ml-1">{{ stats?.projectDetails?.clientStage | titlecase }}</span></p>
                <p class="text-sm flex items-center  dark:text-slate-300"><i class="pi pi-box mr-1 text-teal-500 dark:text-teal-400"></i><span class="font-medium text-gray-800 dark:text-slate-100">Offering:</span> <span class="ml-1">{{ stats?.projectDetails?.productOffering | titlecase }}</span></p>
                <p class="text-sm flex items-center  dark:text-slate-300"><i class="pi mr-1" [ngClass]="stats?.projectDetails?.projectActive ? 'pi-check-circle text-green-500 dark:text-green-400' : 'pi-times-circle text-red-500 dark:text-red-400'"></i>
                    <span class="font-medium text-gray-800 dark:text-slate-100">Status:</span>
                    <span class="ml-1 font-semibold" [ngClass]="stats?.projectDetails?.projectActive ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'">
                        {{ stats?.projectDetails?.projectActive ? 'Active' : 'Inactive' }}
                    </span>
                </p>
            </div>
        </p-card>

        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <ng-template pTemplate="header">
                <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                    <i class="pi pi-file-import mr-1 text-lg text-blue-700 dark:text-blue-400"></i>
                    <h3 class="text-base font-medium text-blue-800 dark:text-blue-300">Invoice Summary</h3>
                </div>
            </ng-template>
            <div class="p-3">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <span class="block text-gray-500 dark:text-slate-400 text-sm font-medium mb-1">Total Paid</span>
                        <div class="text-gray-800 dark:text-slate-100 font-bold text-xl">KSH {{ stats?.invoiceStats?.totalRevenue | number:'1.2-2'}}</div>
                    </div>
                    <div class="flex items-center justify-center bg-blue-100  rounded-full p-2">
                        <i class="pi pi-verified text-blue-500 dark:text-blue-400 text-xl"></i>
                    </div>
                </div>
                <p-divider styleClass="border-gray-200 dark:border-slate-600"></p-divider>
                <div class="mt-3">
                    <span class="block text-gray-500 dark:text-slate-400 text-sm font-medium mb-1">Pending Payment</span>
                    <div class="text-amber-600 dark:text-amber-400 font-bold text-lg">KSH {{ stats?.invoiceStats?.pendingToBeClearedAmount | number:'1.2-2' }}</div>
                </div>
            </div>
        </p-card>
    </div>

    <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
        <ng-template pTemplate="header">
            <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                <i class="pi pi-list-ol mr-1 text-lg  dark:text-slate-300"></i>
                <h3 class="text-base font-medium text-gray-800 dark:text-slate-200">Recent Activities</h3>
            </div>
        </ng-template>
        <div class="p-2">
            <p-table [value]="stats?.recentActivities ?? []" [paginator]="true" [rows]="5" styleClass="p-datatable-striped" [tableStyle]="{'min-width': '100%'}">
                <ng-template pTemplate="header">
                    <tr class="bg-gray-50 dark:bg-slate-700">
                        <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Description</th>
                        <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Timestamp</th>
                        <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">User</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-activity>
                    <tr class="hover:bg-gray-50 dark:hover:bg-slate-700">
                        <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.description }}</td>
                        <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.timestamp | date:'medium' }}</td>
                        <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.user || 'System' }}</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="3" class="text-center p-3 text-gray-500 dark:text-gray-400">No recent activities to display.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </p-card>
</div>

<div *ngIf="hasPrivilege(Permissions.VIEW_AGENT_DASHBOARD) && agentStats && !agentLoading" class="p-4 min-h-screen bg-gray-50 dark:bg-transparent ">
    <div class="mb-6 p-3   rounded-lg">
        <div class="flex items-center">
            <i class="pi pi-shield mr-2 text-2xl"></i>
            <div>
                <h1 class="text-2xl font-semibold">Agent Dashboard</h1>
                <p class="text-sm opacity-90 mt-1">Your client overview and recent activities.</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <div class="flex items-center p-3">
                <div class="p-2 bg-blue-100  rounded-full mr-3">
                    <i class="pi pi-users text-blue-500 dark:text-blue-400 text-2xl"></i>
                </div>
                <div>
                    <h3 class="text-base font-medium  dark:text-slate-200">My Clients</h3>
                    <p class="text-3xl font-bold text-blue-600 dark:text-blue-400">{{ agentStats?.numberOfClients }}</p>
                </div>
            </div>
        </p-card>

        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <div class="flex items-center p-3">
                <div class="p-2 bg-green-100 dark:bg-green-500/20 rounded-full mr-3">
                    <i class="pi pi-money-bill text-green-500 dark:text-green-400 text-2xl"></i>
                </div>
                <div>
                    <h3 class="text-base font-medium  dark:text-slate-200">Total Revenue (Cleared)</h3>
                    <p class="text-xl font-bold text-green-600 dark:text-green-400">KSH {{ agentStats?.invoiceStats?.totalRevenue | number: '1.2-2' }}</p>
                </div>
            </div>
        </p-card>

        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <div class="flex items-center p-3">
                <div class="p-2 bg-amber-100 dark:bg-amber-500/20 rounded-full mr-3">
                    <i class="pi pi-hourglass text-amber-500 dark:text-amber-400 text-2xl"></i>
                </div>
                <div>
                    <h3 class="text-base font-medium  dark:text-slate-200">Pending Revenue</h3>
                    <p class="text-xl font-bold text-amber-600 dark:text-amber-400">KSH {{ agentStats?.invoiceStats?.pendingToBeClearedAmount | number: '1.2-2' }}</p>
                </div>
            </div>
        </p-card>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <ng-template pTemplate="header">
                <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                    <i class="pi pi-address-book mr-1 text-lg text-indigo-700 dark:text-indigo-400"></i>
                    <h3 class="text-base font-medium text-indigo-800 dark:text-indigo-300">My Assigned Clients</h3>
                </div>
            </ng-template>
            <div class="p-2">
                <p-table [value]="agentStats?.clients ?? []" [paginator]="true" [rows]="5" [tableStyle]="{'min-width': '100%'}"
                         responsiveLayout="scroll" styleClass="p-datatable-striped">
                    <ng-template pTemplate="header">
                        <tr class="bg-gray-50 dark:bg-slate-700">
                            <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Name</th>
                            <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Stage</th>
                            <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Contact</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-client>
                        <tr class="hover:bg-gray-50 dark:hover:bg-slate-700">
                            <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300"
                                [pTooltip]="'ID: ' + client.id + '<br>Full Name: ' + client.firstName + ' ' + (client.secondName || '') + ' ' + client.lastName + '<br>Project: ' + (client.projectName || 'N/A') + '<br>Source: ' + (client.clientSource | titlecase) + '<br>Offering: ' + (client.productOffering | titlecase) + '<br>Active: ' + (client.projectActive ? 'Yes' : 'No') + '<br>Follow-up: ' + (client.followUpDate | date: 'mediumDate')"
                                [escape]="false" tooltipPosition="top">
                                {{ client.firstName }} {{ client.lastName }}
                            </td>
                            <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full"
                                      [ngClass]="{
                                        'bg-blue-100 text-blue-700 dark:bg-blue-500/30 dark:text-blue-300': client.clientStage === 'PENDING_SITE_VISIT',
                                        'bg-green-100 text-green-700 dark:bg-green-500/30 dark:text-green-300': client.clientStage === 'REQUIREMENTS_GATHERING',
                                        'bg-yellow-100 text-yellow-700 dark:bg-yellow-500/30 dark:text-yellow-300': client.clientStage === 'PROFORMA_INVOICE_GENERATION',
                                        'bg-purple-100 text-purple-700 dark:bg-purple-500/30 dark:text-purple-300': client.clientStage === 'PENDING_CLIENT_BOQ_APPROVALS',
                                        'bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200': true
                                      }">
                                    {{ client.clientStage | titlecase }}
                                </span>
                            </td>
                            <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300"
                                [pTooltip]="'Email: ' + client.email + '<br>Phone: ' + client.countryCode + client.phoneNumber"
                                [escape]="false" tooltipPosition="left">
                                <i class="pi pi-envelope mr-1 text-blue-500 dark:text-blue-400"></i> / <i class="pi pi-phone ml-1 text-green-500 dark:text-green-400"></i>
                            </td>

                            <td>
                                <i class="pi pi-arrow-up-right hover:cursor-pointer" routerLink="/app/pages/profile/{{client.id}}" style="font-size: 1rem"></i>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="3" class="text-center p-3 text-gray-500 dark:text-gray-400">No clients found.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-card>

        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <ng-template pTemplate="header">
                <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                    <i class="pi pi-chart-line mr-1 text-lg text-green-600 dark:text-green-400"></i>
                    <h3 class="text-base font-medium text-green-700 dark:text-green-300">Revenue Over Time</h3>
                </div>
            </ng-template>
            <div class="p-3">
                <p-chart type="line" [data]="agentRevenueOverTimeChartData" [options]="timeSeriesChartOptions"></p-chart>
            </div>
        </p-card>

        <p-card styleClass="rounded-lg  border border-gray-200 dark:border-slate-700">
            <ng-template pTemplate="header">
                <div class="flex items-center p-2 bg-gray-50 dark:bg-slate-700 rounded-t-lg border-b dark:border-slate-600">
                    <i class="pi pi-list-ol mr-1 text-lg text-indigo-700 dark:text-indigo-400"></i>
                    <h3 class="text-base font-medium text-indigo-800 dark:text-indigo-300">Recent Client Activities</h3>
                </div>
            </ng-template>
            <div class="p-2">
                <p-table [value]="agentStats?.recentActivities ?? []" [paginator]="true" [rows]="5" [tableStyle]="{'min-width': '100%'}"
                         responsiveLayout="scroll" styleClass="p-datatable-striped">
                    <ng-template pTemplate="header">
                        <tr class="bg-gray-50 dark:bg-slate-700">
                            <th class="p-2 text-left text-sm font-medium  dark:text-slate-300 w-3/5">Description</th>
                            <th class="p-2 text-left text-sm font-medium  dark:text-slate-300">Timestamp</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-activity>
                        <tr class="hover:bg-gray-50 dark:hover:bg-slate-700"
                            [pTooltip]="'Activity ID: ' + activity.id + '<br>Client: ' + (activity.client?.firstName + ' ' + activity.client?.lastName) + '<br>User: ' + (activity.user || 'System') + '<br>Client Project: ' + (activity.client?.projectName || 'N/A') + '<br>Full Description: ' + activity.description"
                            [escape]="false" tooltipPosition="top">
                            <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300 truncate max-w-xs"
                                [pTooltip]="activity.description" tooltipPosition="top">
                                {{ activity.description }}
                            </td>
                            <td class="p-2 border-b border-gray-200 dark:border-slate-700  dark:text-slate-300">{{ activity.timestamp | date:'short' }}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="2" class="text-center p-3 text-gray-500 dark:text-gray-400">No recent activities.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-card>
    </div>
</div>

<div *ngIf="(loading && !hasPrivilege(Permissions.VIEW_AGENT_DASHBOARD)) || (agentLoading && hasPrivilege(Permissions.VIEW_AGENT_DASHBOARD))"
     class="fixed inset-0 bg-gray-300 dark:bg-black bg-opacity-50 dark:bg-opacity-60 z-50 flex items-center justify-center backdrop-blur-sm">
    <p-progressSpinner ariaLabel="Loading Data" styleClass="w-10 h-10 md:w-12 md:h-12" strokeWidth="3" animationDuration=".8s"></p-progressSpinner>
</div>

<ngx-spinner
    bdColor="rgba(0, 0, 0, 0.88)"
    size="large"
    color="#60A5FA"
    type="ball-spin-clockwise-fade"
    [fullScreen]="true"
    [name]="'spinner'">
    <p style="color: #E0E0E0; font-size: 1rem; margin-top: 8px; text-shadow: 0 0 3px black;">Loading Dashboard...</p>
</ngx-spinner>

<ngx-spinner
    bdColor="rgba(0, 0, 0, 0.88)"
    size="large"
    color="#818CF8"
    type="ball-pulse-sync"
    [fullScreen]="true"
    [name]="'agentSpinner'">
    <p style="color: #E0E0E0; font-size: 1rem; margin-top: 8px; text-shadow: 0 0 3px black;">Loading Agent Data...</p>
</ngx-spinner>
